commit b75b735800070ed4839993e182544b536175e4e7
Author: SweetRewenge <sweetrewenge@yandex.ru>
Date:   Wed Apr 3 15:11:45 2024 +0500

    restore ci settings fro test

diff --git a/.gitlab-ci.yml b/.gitlab-ci.yml
index 354e5ad..c218df9 100644
--- a/.gitlab-ci.yml
+++ b/.gitlab-ci.yml
@@ -41,7 +41,8 @@ build:stage:
   tags:
     - runner-stage
   only:
-    - staging
+  - staging
+  - staging_frontend_test
   script:
     - build_image
 
@@ -50,7 +51,8 @@ deploy:stage:
   tags:
     - runner-stage
   only:
-    - staging
+  - staging
+  - staging_frontend_test
   environment:
     name: ${CI_COMMIT_REF_SLUG}
     url: "${STAGE_DOMAIN}${PRODUCTION_PATH}"
@@ -63,7 +65,8 @@ test:stage:
   tags:
     - runner-stage
   only:
-    - staging
+  - staging
+  - staging_frontend_test
   script:
     - test_app
 
@@ -72,7 +75,8 @@ destroy:stage:
   tags:
     - runner-stage
   only:
-    - staging
+  - staging
+  - staging_frontend_test
   environment:
     name: ${CI_COMMIT_REF_SLUG}
     action: stop
@@ -166,7 +170,7 @@ destroy:dev:
     export ENV_FULL_NAME="staging"
     export APP_NAMESPACE="${CI_COMMIT_REF_SLUG}"
     export APP_URL="${STAGE_TEST_DOMAIN}${PRODUCTION_PATH}"
-    export APP_URL0="${APP_STAGE_TEST_DOMAIN}${PRODUCTION_PATH}"
+    export APP0_URL="${APP_STAGE_TEST_DOMAIN}${PRODUCTION_PATH}"
     export WERF_REPO="${REGISTRY_NAME_STAGE}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}"
     export REPOSITORY_NAME="${REPOSITORY_NAME_STAGE}"
     export SECRET_VALUES_FILE="secret-values-stage.yaml"
diff --git a/.helm/templates/38-app.yaml b/.helm/templates/38-app.yaml
index 85ac500..584a7af 100644
--- a/.helm/templates/38-app.yaml
+++ b/.helm/templates/38-app.yaml
@@ -21,7 +21,7 @@ spec:
         ksync: {{ .Values.global.app_name }}
     spec:
       containers:
-        - name: nuxt
+        - name: {{ .Values.global.app_name }}
           image: {{ .Values.werf.image.app }}
           env:
 {{ include "apps-env-var-values" . | indent 12 }}
@@ -48,39 +48,6 @@ spec:
             limits:
               memory: "1Gi"
               cpu: "500m"
-        - name: nginx
-          image: {{ .Values.werf.image.nginx }}
-          securityContext:
-            allowPrivilegeEscalation: false
-            capabilities:
-              drop:
-              - ALL
-            runAsNonRoot: true
-            runAsUser: 101
-            seccompProfile:
-              type: RuntimeDefault
-          ports:
-            - name: http
-              containerPort: 80
-          volumeMounts:
-            - name: nginx-config-volume-1
-              mountPath: /etc/nginx
-            - name: nginx-config-volume-2
-              mountPath: /etc/nginx/conf.d
-          resources:
-            requests:
-              memory: "128Mi"
-              cpu: "250m"
-            limits:
-              memory: "2048Mi"
-              cpu: "750m"
-      volumes:
-        - name: nginx-config-volume-1
-          configMap:
-            name: nginx-config-1
-        - name: nginx-config-volume-2
-          configMap:
-            name: nginx-config-2
       imagePullSecrets:
         - name: docker-registry
 ---
@@ -90,7 +57,7 @@ metadata:
   name: {{ .Values.global.app_name }}
 spec:
   ports:
-    - port: 80
+    - port: 3000
       name: http
   selector:
     app: {{ .Values.global.app_name }}
diff --git a/werf.yaml b/werf.yaml
index 2baf070..8f9b113 100644
--- a/werf.yaml
+++ b/werf.yaml
@@ -29,14 +29,6 @@ cleanup:
       imagesPerReference:
         last: 2
 ---
-image: nginx
-from: nginx:stable-alpine
-git:
-  - add: /public
-    to: /var/www/html/public
-docker:
-  WORKDIR: /var/www/html
----
 image: app
 from: node:current-alpine
 docker:
@@ -74,4 +66,4 @@ shell:
     - export DOMAIN="{{ $appUrl }}"
     - export APP_DOMAIN="{{ $app0Url }}"
     - pnpm build
----
\ No newline at end of file
+---
